from typing import Any, Dict, override

from lorelie.backends import SQLiteBackend
from lorelie.expressions import Q
from lorelie.fields.base import Field


class BaseConstraint:
    template_sql: str = ...
    prefix: str = ...
    base_errors: Dict[str, str] = ...

    def __init__(self, name: str) -> None: ...
    def __repr__(self) -> str: ...
    def __hash__(self) -> int: ...

    @property
    def generated_name(self) -> str: ...

    def as_sql(self, backend: SQLiteBackend) -> str: ...


class CheckConstraint(BaseConstraint):
    name: str = ...
    condition: Q = ...

    def __init__(self, name: str, condition: Q) -> None: ...

    @override
    def as_sql(self, backend: SQLiteBackend) -> str: ...


class UniqueConstraint(BaseConstraint):
    fields: list[str] = ...

    def __init__(self, name: str, *, fields: list[str] = ...) -> None: ...

    @override
    def as_sql(self, backend: SQLiteBackend) -> str: ...


class MaxLengthConstraint(CheckConstraint):
    max_length: int = ...
    length_sql: str = ...

    def __init__(self, limit: int, field: Field = ...): ...
    def __call__(self, value: Any): ...

    @override
    def as_sql(self, backend: SQLiteBackend) -> str: ...


class MinValueConstraint(BaseConstraint):
    def __init__(self, limit: int, field: Field) -> None: ...


class MaxValueConstraint(MinValueConstraint):
    ...
